<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PostBus Connect ‚Äì Navettes ski (Prototype MobilityLab)</title>
<meta name="description" content="Navettes directes CarPostal (bus midi Iveco 40 places, 2+2). Offre compl√©mentaire aux TP sur les axes o√π la voiture est nettement moins contraignante. R√©servation, si√®ges premium, m√©t√©o, carte.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ===== Reset + tokens ===== */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#0e0e0e;background:#fff;line-height:1.6}
:root{
  --brand:#FFD300; --ink:#0e0e0e; --muted:#565656;
  --alt:#f6f7f9; --blue:#1F7AE0; --ok:#0a7b25; --danger:#C62828;
  --shadow:0 8px 24px rgba(0,0,0,.08); --radius:12px; --max:1180px;
}
@media (prefers-color-scheme:dark){
  :root{ --ink:#f4f4f4; --muted:#bdbdbd; --alt:#17181b; }
  body{ background:#121316; color:var(--ink) }
  header{ background:rgba(20,21,24,.6); border-bottom:1px solid #2a2c31 }
  .card,details{ background:#1b1d21; border-color:#2a2c31 }
}

/* Layout */
.container{width:min(92vw,var(--max));margin:auto}
h1{font-size:clamp(28px,3.2vw,44px);line-height:1.15}
h2{font-size:clamp(22px,2.6vw,32px);margin-bottom:.5rem}
h3{font-size:clamp(18px,2vw,22px)}
p{margin:.35rem 0}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block;border-radius:10px}

/* Header/Nav */
header{position:fixed;inset:0 0 auto 0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #eee}
.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.logo{display:flex;align-items:center;gap:.6rem;font-weight:800}
.logo img{height:26px}
.navlinks{display:flex;gap:18px;align-items:center}
.navlinks a{font-weight:600;color:#333}
.cta{background:var(--brand);color:#000;padding:10px 14px;border-radius:10px;font-weight:800}
@media (max-width:860px){.navlinks{display:none}}

/* Hero */
#hero{position:relative;padding:120px 0 80px;background:
  linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.35)),
  url('images/crans_montana.jpg') center/cover no-repeat;color:#fff;text-align:center}
#hero .badge{display:inline-flex;gap:8px;background:#fff;color:#111;padding:6px 10px;border-radius:999px;font-size:.9rem;margin-top:12px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 18px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
.btn.primary{background:var(--brand);color:#000}
.btn.ghost{background:rgba(255,255,255,.15);color:#fff;border:2px solid rgba(255,255,255,.45)}
.btn:focus{outline:3px solid #84b6ff; outline-offset:2px}
.hero-kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:22px}
.kpi{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);border-radius:10px;padding:10px}
.kpi strong{font-size:18px}
@media (max-width:780px){.hero-kpis{grid-template-columns:repeat(2,1fr)}}

/* Sections */
section{padding:64px 0}
.muted{color:var(--muted)}
.card{background:#fff;border:1px solid #eee;border-radius:var(--radius);box-shadow:var(--shadow)}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
@media (max-width:980px){.grid-3,.grid-2{grid-template-columns:1fr}}
.adv{padding:14px}

/* Reservation */
#reservation .card{padding:18px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-grid .full{grid-column:1/-1}
label{font-weight:700;font-size:.92rem}
select,input[type="date"]{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;background:#fff;font-size:1rem}
select:focus,input:focus{outline:3px solid #84b6ff; outline-offset:2px}
.inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px dashed #bbb;padding:6px 10px;border-radius:999px;font-size:.9rem}

/* results */
.results{margin-top:14px;display:none}
.trip{display:flex;flex-wrap:wrap;justify-content:space-between;gap:8px;padding:14px;border:1px solid #eee;border-radius:10px}
.price{font-weight:900}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:800}
.badge.tp{background:#e8f5ff;border:1px solid #bcdcff;color:#0d47a1}
.badge.block{background:#ffe3e3;border:1px solid #f2bcbc;color:#8a0000}

/* ===== Seat map Iveco 40p ‚Äî 2+2 (10 rang√©es, couloir central) ===== */
.seat-area h3{margin-top:12px}
.seat-wrap{display:flex;gap:16px;justify-content:center;align-items:flex-start;flex-wrap:wrap}
.seat-legend{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.seat-legend .box{width:14px;height:14px;border-radius:3px;border:1px solid #ccc;background:#fafafa}
.seat-legend .box.prem{background:#fff8cc;border-color:#e6c200}
.seat-legend .pill{margin-left:6px}
.bus{
  --seat:48px; --aisle:26px;
  display:grid;
  grid-template-columns: repeat(2,var(--seat)) var(--aisle) repeat(2,var(--seat));
  gap:8px;
  padding:10px; border:1px dashed #cfcfcf; border-radius:12px; background:#fafafa;
}
.seat{
  width:var(--seat); height:var(--seat);
  border:1px solid #d7d7d7; border-radius:8px; background:#fff;
  display:grid; place-items:center; font-weight:700; cursor:pointer;
}
.seat.premium{background:#fff8cc;border-color:#e6c200}
.seat.selected{outline:3px solid var(--blue); border-color:var(--blue)}
/* dossier conducteur simple */
.bus-head{grid-column:1 / -1; text-align:center; font-size:.85rem; color:#666; margin-bottom:2px}

/* tarifs */
#tarifs .card{padding:18px;text-align:center}
.price-big{font-size:34px;font-weight:900}

/* m√©t√©o */
.weather{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media (max-width:980px){.weather{grid-template-columns:1fr}}
.wcard{padding:14px}

/* carte */
#map{width:100%;height:420px;border-radius:12px;border:1px solid #e5e5e5;background:url('images/nax.jpg') center/cover no-repeat}

/* Footer */
footer{background:#111;color:#ddd;padding:30px 0;margin-top:40px}
footer a{color:#eee}
.footgrid{display:grid;grid-template-columns:2fr 1fr 1fr;gap:18px}
@media (max-width:980px){.footgrid{grid-template-columns:1fr}}

/* Mobile sticky CTA */
.sticky-cta{
  position:fixed; inset:auto 0 0 0; z-index:60; background:#111; color:#fff;
  display:flex; gap:10px; padding:10px; justify-content:center; align-items:center;
}
.sticky-cta a{background:var(--brand); color:#000; padding:10px 14px; border-radius:10px; font-weight:800}
@media (min-width:861px){.sticky-cta{display:none}}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="logo">
      <img src="images/logo-carpostal.png" alt="CarPostal">
      <span>PostBus Connect</span>
      <span class="pill">Prototype MobilityLab</span>
    </div>
    <nav class="navlinks">
      <a href="#objectifs">Objectifs</a>
      <a href="#fonctionnement">Fonctionnement</a>
      <a href="#reservation">R√©server</a>
      <a href="#carte">Carte</a>
      <a href="#meteo">M√©t√©o</a>
      <a href="#faq">FAQ</a>
      <a href="#tarifs" class="cta">Tarifs</a>
    </nav>
  </div>
</header>

<!-- HERO -->
<section id="hero" aria-label="Haut de page">
  <div class="container">
    <h1>Navettes directes vers les pistes ‚Äî Offre <u>compl√©mentaire aux TP</u></h1>
    <p class="muted" style="max-width:780px;margin:8px auto 0">
      Flotte pilote : <b>3 bus CarPostal ‚Äúmidi‚Äù Iveco ‚Äî 40 places (2+2)</b>.  
      Nous op√©rons uniquement l√† o√π la <b>voiture est nettement moins contraignante</b> que les TP (dur√©e, correspondances, marche).
    </p>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <a class="btn primary" href="#reservation">Planifier un trajet</a>
      <a class="btn ghost" href="#avantages">Pourquoi c‚Äôest mieux ?</a>
    </div>
    <div class="hero-kpis">
      <div class="kpi"><strong>Vendredi‚ÄìDimanche</strong><br><span class="muted">Saison de ski</span></div>
      <div class="kpi"><strong>2+2 si√®ges</strong><br><span class="muted">10 rang√©es ‚Äì 40 places</span></div>
      <div class="kpi"><strong>D√©parts matin</strong><br><span class="muted">retours fin de journ√©e</span></div>
      <div class="kpi"><strong>Si√®ges premium</strong><br><span class="muted">+ tarif dynamique</span></div>
    </div>
    <div class="badge">Prototype MobilityLab 2025 üöÄ</div>
  </div>
</section>

<!-- OBJECTIFS -->
<section id="objectifs">
  <div class="container grid-2">
    <div class="card" style="padding:16px"><h3>üí° Innovation & revenus</h3><p class="muted">Tarifs dynamiques + upsell si√®ge premium + pack 5 A/R.</p></div>
    <div class="card" style="padding:16px"><h3>üôå R√©pond au march√©</h3><p class="muted">UX simple, infos utiles (m√©t√©o, carte), r√©servation en 3 √©tapes.</p></div>
    <div class="card" style="padding:16px"><h3>üåç R√©duction TIM</h3><p class="muted">Moins de voitures vers les stations ‚Üí moins de CO‚ÇÇ & congestion.</p></div>
    <div class="card" style="padding:16px"><h3>üß™ Prototype b√™ta</h3><p class="muted">Transparence & it√©rations rapides avec vos retours.</p></div>
  </div>
</section>

<!-- COMMENT CA MARCHE -->
<section id="fonctionnement" style="background:var(--alt)">
  <div class="container">
    <h2>Comment √ßa marche</h2>
    <div class="grid-3">
      <div class="card adv">
        <img src="images/anzere.jpg" alt="Choix d'un axe √©ligible">
        <h3>1) Choisir un axe √©ligible</h3>
        <p class="muted">Uniquement l√† o√π la voiture est <b>nettement plus simple</b> que les TP.</p>
      </div>
      <div class="card adv">
        <img src="images/ovronnaz.jpg" alt="Navette directe">
        <h3>2) Navette directe</h3>
        <p class="muted">Align√©e sur l‚Äôouverture des pistes, retour fin de journ√©e.</p>
      </div>
      <div class="card adv">
        <img src="images/leukerbad.jpg" alt="R√©servation & si√®ge">
        <h3>3) R√©server & choisir un si√®ge</h3>
        <p class="muted">Paiement en ligne, rangs <b>1‚Äì2 premium</b> en option.</p>
      </div>
    </div>
  </div>
</section>

<!-- AVANTAGES -->
<section id="avantages">
  <div class="container">
    <h2>Pourquoi c‚Äôest mieux&nbsp;?</h2>
    <div class="grid-3">
      <div class="card adv">
        <img src="images/crans_montana.jpg" alt="Temps gagn√©">
        <h3>‚è± +45 √† +120 min</h3>
        <p class="muted">selon l‚Äôaxe, vs TP multi-correspondances.</p>
      </div>
      <div class="card adv">
        <img src="images/zinal.jpg" alt="Z√©ro correspondance">
        <h3>üß≥ Z√©ro correspondance</h3>
        <p class="muted">Centre-ville ‚Üí station, porte-skis √† bord.</p>
      </div>
      <div class="card adv">
        <img src="images/nax.jpg" alt="Impact">
        <h3>üå± Impact positif</h3>
        <p class="muted">Moins de voitures en vall√©e alpine.</p>
      </div>
    </div>
  </div>
</section>

<!-- RESERVATION (√©ligibilit√© r√©elle + bus 2+2) -->
<section id="reservation" aria-label="R√©servation">
  <div class="container">
    <h2>Planifier & r√©server</h2>
    <div class="card">
      <div class="form-grid">
        <div>
          <label for="from">Ville de d√©part</label>
          <select id="from">
            <option value="">S√©lectionnez‚Ä¶</option>
            <option>Gen√®ve</option>
            <option>Lausanne</option>
          </select>
        </div>
        <div>
          <label for="to">Station (√©ligible)</label>
          <select id="to">
            <option value="">S√©lectionnez‚Ä¶</option>
            <option data-city="Gen√®ve">Zinal</option>
            <option data-city="Gen√®ve">Ovronnaz</option>
            <option data-city="Lausanne">Ovronnaz</option>
            <option data-city="Lausanne">Leukerbad</option>
          </select>
        </div>
        <div>
          <label for="date">Date (ven‚Äìdim)</label>
          <input type="date" id="date">
        </div>
        <div>
          <label for="pack">Pack 5 A/R</label>
          <select id="pack">
            <option value="no">Non</option>
            <option value="yes">Oui (CHF 100)</option>
          </select>
        </div>
        <div class="full inline">
          <button class="btn primary" id="searchBtn">Voir les navettes</button>
          <span class="pill">Flotte : 3 bus Iveco ‚Äúmidi‚Äù ¬∑ 40 places (2+2)</span>
          <span class="pill">Offre <b>compl√©mentaire aux TP</b></span>
        </div>
      </div>

      <div class="results" id="results">
        <div class="trip">
          <div>
            <strong id="summaryRoute">‚Äî</strong><br>
            <span class="muted" id="summaryTime">‚Äî</span><br>
            <span id="eligBadge" class="badge tp">Compl√©ment aux TP</span>
            <span id="eligWhy" class="muted" style="display:block;margin-top:4px">‚Äî</span>
          </div>
          <div>
            <span class="muted">Prix estim√©</span><br>
            <span class="price" id="price">‚Äî</span>
          </div>
          <div class="inline">
            <button class="btn" id="seatBtn" style="background:#eef5ff;color:#0d47a1">Choisir un si√®ge</button>
            <button class="btn primary" id="payBtn">Payer</button>
          </div>
        </div>

        <!-- Seat map 2+2 -->
        <div id="seatArea" class="seat-area" style="display:none">
          <h3>Plan du bus (Iveco ‚Äúmidi‚Äù ‚Äì 40 places, 2+2)</h3>
          <div class="seat-wrap">
            <div>
              <div class="bus-head">Avant</div>
              <div id="bus" class="bus" role="grid" aria-label="Plan de si√®ges 2+2, 10 rang√©es"></div>
            </div>
            <div class="seat-legend">
              <div class="box"></div> <span class="muted">Standard</span>
              <div class="box prem"></div> <span class="muted">Premium (rangs 1‚Äì2)</span>
              <span class="pill" id="seatChoice">Aucun si√®ge s√©lectionn√©</span>
            </div>
          </div>
        </div>
      </div>

      <p class="muted" style="margin-top:10px">‚ùå Demi-tarif/abonnements TP non applicables (produit sp√©cifique CarPostal).</p>
    </div>
  </div>
</section>

<!-- TARIFS -->
<section id="tarifs" style="background:var(--alt)">
  <div class="container">
    <h2>Tarifs & offres</h2>
    <div class="grid-2">
      <div class="card" style="padding:18px;text-align:center">
        <img src="images/ovronnaz.jpg" alt="Pack 5 A/R" style="height:160px;object-fit:cover">
        <h3>üéüÔ∏è Pack 5 allers-retours</h3>
        <div class="price-big">CHF 100.‚Äì</div>
        <p class="muted">Soit CHF 20.‚Äì par A/R ¬∑ valable sur axes √©ligibles</p>
        <span class="badge" style="background:#fff8cc;border:1px solid #e6c200;color:#5f4b00">Meilleur rapport valeur</span>
      </div>
      <div class="card" style="padding:18px;text-align:center">
        <img src="images/zinal.jpg" alt="Tarif dynamique" style="height:160px;object-fit:cover">
        <h3>üí∫ Trajet √† l‚Äôunit√©</h3>
        <div class="price-big">d√®s CHF 25.‚Äì</div>
        <p class="muted">Tarification dynamique (type EasyJet) selon demande/date</p>
        <p class="muted">Option <b>si√®ge premium</b> (rangs 1‚Äì2)</p>
      </div>
    </div>
  </div>
</section>

<!-- CARTE -->
<section id="carte">
  <div class="container">
    <h2>Carte des itin√©raires (axes √©ligibles)</h2>
    <p class="muted">Nous op√©rons uniquement l√† o√π les TP sont moins performants (temps, changements, marche).</p>
    <div id="map" role="img" aria-label="Carte des trajets (placeholder avec Nax)"></div>
  </div>
</section>

<!-- METEO -->
<section id="meteo" style="background:var(--alt)">
  <div class="container">
    <h2>M√©t√©o & neige</h2>
    <div class="weather">
      <div class="card wcard">
        <img src="images/crans_montana.jpg" alt="Crans-Montana">
        <h3>Crans-Montana</h3>
        <p class="muted">0 ¬∞C ¬∑ Ensoleill√© ¬∑ Neige: 120/200 cm</p>
      </div>
      <div class="card wcard">
        <img src="images/anzere.jpg" alt="Anz√®re">
        <h3>Anz√®re</h3>
        <p class="muted">-1 ¬∞C ¬∑ √âclaircies ¬∑ Neige: 90/170 cm</p>
      </div>
      <div class="card wcard">
        <img src="images/leukerbad.jpg" alt="Leukerbad">
        <h3>Leukerbad</h3>
        <p class="muted">-3 ¬∞C ¬∑ Chutes faibles ¬∑ Neige: 110/180 cm</p>
      </div>
    </div>
    <p class="muted" style="margin-top:8px;font-size:.9rem">*Connexion API m√©t√©o/neige possible (Open-Meteo / MeteoSwiss + flux stations).</p>
  </div>
</section>

<!-- FAQ -->
<section id="faq" style="background:var(--alt)">
  <div class="container">
    <h2>FAQ</h2>
    <details><summary>Pourquoi certaines stations ne sont pas propos√©es&nbsp;?</summary>
      <p>Parce que nous ne voulons pas concurrencer les TP. Nous op√©rons <b>uniquement</b> l√† o√π la voiture est beaucoup moins contraignante que les TP (dur√©e, correspondances, marche).</p>
    </details>
    <details><summary>Quel bus utilisez-vous&nbsp;?</summary>
      <p>Un <b>CarPostal ‚Äúmidi‚Äù Iveco ‚Äì 40 places</b>, configuration <b>2+2</b>. 3 bus pendant la phase pilote.</p>
    </details>
    <details><summary>Le demi-tarif est-il valable&nbsp;?</summary>
      <p>Non, il s‚Äôagit d‚Äôun produit sp√©cifique CarPostal, distinct de l‚Äôoffre TP.</p>
    </details>
  </div>
</section>

<footer>
  <div class="container footgrid">
    <div>
      <strong>PostBus Connect</strong><br>
      <span class="muted">¬© 2025 MobilityLab & CarPostal</span><br>
      <span class="muted">Prototype ‚Äì offre compl√©mentaire aux TP</span>
    </div>
    <div>
      <strong>Navigation</strong><br>
      <a href="#reservation">R√©server</a><br>
      <a href="#tarifs">Tarifs</a><br>
      <a href="#faq">FAQ</a>
    </div>
    <div>
      <strong>L√©gal</strong><br>
      <a href="#">Mentions</a><br>
      <a href="#">Conditions</a><br>
      <a href="#">Confidentialit√©</a>
    </div>
  </div>
</footer>

<!-- Mobile sticky CTA -->
<div class="sticky-cta" aria-hidden="false">
  <a href="#reservation">Planifier</a>
  <a href="#payBtn">Payer</a>
</div>

<script>
/* ===== √âLIGIBILIT√â r√©elle (axes compl√©mentaires aux TP) ===== */
const ELIGIBILITY = {
  "Gen√®ve ‚áÑ Zinal": {
    eligible: true,
    reason: "TP ~4h24 avec plusieurs changements ; voiture ~2h27 (gain ~2h)."
  },
  "Lausanne ‚áÑ Ovronnaz": {
    eligible: true,
    reason: "TP ~2h42 via Riddes/Leytron ; voiture 1h06‚Äì1h12 (gain ~1h30)."
  },
  "Gen√®ve ‚áÑ Ovronnaz": {
    eligible: true,
    reason: "TP ~3h35 ; voiture ~1h59 (gain ~1h35)."
  },
  "Lausanne ‚áÑ Leukerbad": {
    eligible: true,
    reason: "TP ~2h17 (train + bus) ; voiture ~1h32 (gain ~45 min)."
  },
  // exemples non √©ligibles (si un jour on les remet dans le s√©lecteur)
  "Lausanne ‚áÑ Crans-Montana": { eligible:false, reason:"√âcart faible : TP ~1h40‚Äì1h45 vs voiture ~1h27‚Äì1h30." },
  "Sion ‚áÑ Anz√®re": { eligible:false, reason:"Bus PostAuto direct ~30‚Äì40 min, comparable √† la voiture." },
  "Sion ‚áÑ Nax": { eligible:false, reason:"Bus fr√©quent 12‚Äì39 min, avantage voiture minime." }
};

/* Helpers */
const $ = s=>document.querySelector(s); const $$ = s=>document.querySelectorAll(s);
function isWeekend(dateStr){ const d=new Date(dateStr+"T12:00:00"); if(isNaN(d))return false; const g=d.getDay(); return [5,6,0].includes(g) }
function dynamicBasePrice(dateStr){
  const d=new Date(dateStr+"T12:00:00"), now=new Date(); const dd=Math.ceil((d-now)/86400000);
  let base=25; if(dd<=3) base=38; else if(dd<=10) base=32; else base=27;
  const demand=0.85+Math.random()*0.6; return Math.round(base*demand);
}
function randomSchedule(){ const r=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const dep=`${String(r(6,7)).padStart(2,'0')}:${r(0,1)?'30':'00'}`, ret=`${String(r(16,17)).padStart(2,'0')}:${r(0,1)?'15':'45'}`; return {dep,ret}; }
function CHF(n){ return "CHF "+n.toFixed(0)+".-"; }

/* Filtre la station selon la ville */
const toSel = $("#to");
$("#from").addEventListener("change", e=>{
  const city=e.target.value;
  [...toSel.options].forEach(o=>{ if(!o.value) return; o.hidden = (o.dataset.city !== city); });
  toSel.value="";
});
function getKey(from,to){ return `${from} ‚áÑ ${to}`; }

/* === Seat map 2+2 : 10 rang√©es, premium rangs 1‚Äì2 === */
const ROWS=10, PREMIUM_ROWS=2; let selectedSeat=null, currentPrice=0;
function buildBus(){
  const bus=$("#bus"); bus.innerHTML="";
  // ligne de t√™te
  const head=document.createElement('div'); head.textContent="Conducteur"; head.className="bus-head"; bus.parentElement.prepend(head);
  for(let r=1;r<=ROWS;r++){
    // 2 si√®ges gauche
    for(let c=1;c<=2;c++){
      const idx=`${r}${String.fromCharCode(64+c)}`; // 1A,1B
      const b=document.createElement('button'); b.type="button"; b.className="seat"+(r<=PREMIUM_ROWS?" premium":""); b.textContent=idx;
      b.setAttribute("aria-label","Si√®ge "+idx+(r<=PREMIUM_ROWS?" premium":""));
      b.onclick=()=>selectSeat(b,idx,(r<=PREMIUM_ROWS));
      bus.appendChild(b);
    }
    // couloir (case vide dans la grille)
    const spacer=document.createElement('div'); spacer.style.width="26px"; spacer.style.height="1px"; bus.appendChild(spacer);
    // 2 si√®ges droite
    for(let c=3;c<=4;c++){
      const idx=`${r}${String.fromCharCode(64+c)}`; // 1C,1D
      const b=document.createElement('button'); b.type="button"; b.className="seat"+(r<=PREMIUM_ROWS?" premium":""); b.textContent=idx;
      b.setAttribute("aria-label","Si√®ge "+idx+(r<=PREMIUM_ROWS?" premium":""));
      b.onclick=()=>selectSeat(b,idx,(r<=PREMIUM_ROWS));
      bus.appendChild(b);
    }
  }
}
function selectSeat(btn, id, isPrem){
  $$(".seat").forEach(s=>s.classList.remove("selected"));
  btn.classList.add("selected"); selectedSeat={id,premium:isPrem};
  $("#seatChoice").textContent=`Si√®ge ${id}`+(isPrem?" (premium)":"");
  updatePrice();
}
function updatePrice(){
  let p=currentPrice;
  if(selectedSeat?.premium) p += 5; // surcharge premium
  $("#price").textContent = CHF(p);
}

/* Recherche */
$("#searchBtn").addEventListener("click", ()=>{
  const from=$("#from").value.trim(), to=$("#to").value.trim(), date=$("#date").value, pack=$("#pack").value;
  if(!from||!to||!date){ alert("Merci de compl√©ter ville, station et date."); return; }
  if(!isWeekend(date)){ alert("Les navettes roulent ven/sam/dim pendant la saison de ski."); return; }

  const key=getKey(from,to);
  const meta=ELIGIBILITY[key] || {eligible:false,reason:"Axe bien desservi par les TP ‚Äî privil√©giez les transports publics."};
  $("#summaryRoute").textContent=`${from} ‚Üí ${to}`;
  const sc=randomSchedule(); $("#summaryTime").textContent=`D√©part ${sc.dep} ‚Äî Retour ${sc.ret}`;
  $("#eligWhy").textContent = meta.reason;

  if(!meta.eligible){
    $("#eligBadge").className="badge block"; $("#eligBadge").textContent="Non √©ligible (privil√©gier les TP)";
    $("#price").textContent="‚Äî"; $("#seatArea").style.display="none"; $("#results").style.display="block"; return;
  } else {
    $("#eligBadge").className="badge tp"; $("#eligBadge").textContent="Compl√©ment aux TP";
  }

  // prix
  if(pack==="yes"){ currentPrice=20; $("#price").textContent="Inclus pack (CHF 20.- / A-R)"; }
  else { currentPrice=dynamicBasePrice(date); updatePrice(); }

  // si√®ges
  selectedSeat=null; $("#seatChoice").textContent="Aucun si√®ge s√©lectionn√©";
  if(!$("#bus").children.length) buildBus();
  $("#seatArea").style.display="block";
  $("#results").style.display="block";
});

/* Paiement (mock) */
$("#payBtn").addEventListener("click", ()=>{
  if($("#eligBadge").classList.contains("block")){ alert("Nous ne vendons pas cet axe (bien desservi par les TP)."); return; }
  const seatTxt = selectedSeat ? `Si√®ge ${selectedSeat.id}${selectedSeat.premium?" (premium)":""}` : "Si√®ge non s√©lectionn√©";
  alert(`√âtape paiement (prototype)\n${$("#summaryRoute").textContent}\n${$("#summaryTime").textContent}\n${$("#price").textContent}\n${seatTxt}`);
});

/* Pr√©remplir un week-end proche */
(function(){
  const input=$("#date"); const t=new Date(); let d=new Date(t);
  for(let i=0;i<14;i++){ d=new Date(d.getTime()+86400000); if([5,6,0].includes(d.getDay())) break; }
  input.value=d.toISOString().split('T')[0];
})();

/* Accessibilit√© : activer focus visible au clavier sur si√®ges */
document.addEventListener('keydown', e=>{
  if(e.key==="Tab"){ document.body.classList.add('kbd'); }
});
</script>
</body>
</html>

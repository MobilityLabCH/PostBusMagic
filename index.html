<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PostBus Connect ‚Äì Navettes ski (Prototype MobilityLab)</title>
<meta name="description" content="Navettes directes CarPostal (bus midi Iveco 40 places). Offre compl√©mentaire aux TP pour axes moins bien desservis. R√©servation, si√®ges premium, m√©t√©o, carte.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* ====== Reset + tokens ====== */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#0e0e0e;background:#fff;line-height:1.6}
:root{
  --brand:#FFD300; --ink:#0e0e0e; --muted:#5a5a5a;
  --bg:#fff; --alt:#f6f7f9; --blue:#1F7AE0;
  --ok:#0a7b25; --warn:#C15A00; --danger:#C62828;
  --shadow:0 8px 24px rgba(0,0,0,.08); --radius:12px; --max:1180px;
}
.container{width:min(92vw,var(--max));margin:auto}
h1{font-size:clamp(28px,3.2vw,44px);line-height:1.15}
h2{font-size:clamp(22px,2.6vw,32px);margin-bottom:.5rem}
h3{font-size:clamp(18px,2vw,22px)}
p{margin:.35rem 0}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block;border-radius:10px}

/* ====== Header/Nav ====== */
header{position:fixed;inset:0 0 auto 0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #eee}
.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.logo{display:flex;align-items:center;gap:.6rem;font-weight:800}
.logo img{height:26px}
.navlinks{display:flex;gap:18px;align-items:center}
.navlinks a{font-weight:600;color:#333}
.cta{background:var(--brand);color:#000;padding:10px 14px;border-radius:10px;font-weight:800}
@media (max-width:860px){.navlinks{display:none}}

/* ====== Hero ====== */
#hero{position:relative;padding:120px 0 80px;background:
  linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.35)),
  url('images/crans_montana.jpg') center/cover no-repeat;color:#fff;text-align:center}
#hero .badge{display:inline-flex;gap:8px;background:#fff;color:#111;padding:6px 10px;border-radius:999px;font-size:.9rem;margin-top:12px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 18px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
.btn.primary{background:var(--brand);color:#000}
.btn.ghost{background:rgba(255,255,255,.15);color:#fff;border:2px solid rgba(255,255,255,.45)}
.hero-kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:22px}
.kpi{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);border-radius:10px;padding:10px}
.kpi strong{font-size:18px}
@media (max-width:780px){.hero-kpis{grid-template-columns:repeat(2,1fr)}}

/* ====== Sections ====== */
section{padding:64px 0}
.muted{color:var(--muted)}
.card{background:#fff;border:1px solid #eee;border-radius:var(--radius);box-shadow:var(--shadow)}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
@media (max-width:980px){.grid-3,.grid-2{grid-template-columns:1fr}}

/* ====== Avantages / Steps ====== */
.adv{padding:14px}

/* ====== Reservation ====== */
#reservation .card{padding:18px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-grid .full{grid-column:1/-1}
label{font-weight:700;font-size:.92rem}
select,input[type="date"]{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;background:#fff;font-size:1rem}
.inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px dashed #bbb;padding:6px 10px;border-radius:999px;font-size:.9rem}

/* results */
.results{margin-top:14px;display:none}
.trip{display:flex;flex-wrap:wrap;justify-content:space-between;gap:8px;padding:14px;border:1px solid #eee;border-radius:10px}
.price{font-weight:900}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:800}
.badge.tp{background:#e8f5ff;border:1px solid #bcdcff;color:#0d47a1}
.badge.warn{background:#fff3e0;border:1px solid #ffd7a2;color:#7a4b00}
.badge.block{background:#ffe3e3;border:1px solid #f2bcbc;color:#8a0000}

/* seat map: 8 x 5 (40 places) */
.seat-map{margin-top:12px;display:grid;grid-template-columns:repeat(5,1fr);gap:6px;max-width:420px}
.seat{padding:10px 0;border:1px solid #ddd;border-radius:8px;text-align:center;cursor:pointer;background:#fafafa}
.seat.premium{border-color:#bfa300;background:#fff8cc}
.seat.selected{outline:3px solid var(--blue)}
.legend{display:flex;gap:10px;margin-top:8px;align-items:center}
.legend .box{width:14px;height:14px;border-radius:3px;border:1px solid #ccc;background:#fafafa}
.legend .box.prem{background:#fff8cc;border-color:#e6c200}

/* tarifs */
#tarifs .card{padding:18px;text-align:center}
.price-big{font-size:34px;font-weight:900}

/* m√©t√©o */
.weather{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media (max-width:980px){.weather{grid-template-columns:1fr}}
.wcard{padding:14px}

/* carte */
#map{width:100%;height:420px;border-radius:12px;border:1px solid #e5e5e5;background:url('images/nax.jpg') center/cover no-repeat}

/* footer */
footer{background:#111;color:#ddd;padding:30px 0;margin-top:40px}
footer a{color:#eee}
.footgrid{display:grid;grid-template-columns:2fr 1fr 1fr;gap:18px}
@media (max-width:980px){.footgrid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="logo">
      <img src="images/logo-carpostal.png" alt="CarPostal">
      <span>PostBus Connect</span>
      <span class="pill">Prototype MobilityLab</span>
    </div>
    <nav class="navlinks">
      <a href="#objectifs">Objectifs</a>
      <a href="#fonctionnement">Fonctionnement</a>
      <a href="#reservation">R√©server</a>
      <a href="#carte">Carte</a>
      <a href="#meteo">M√©t√©o</a>
      <a href="#faq">FAQ</a>
      <a href="#tarifs" class="cta">Tarifs</a>
    </nav>
  </div>
</header>

<!-- HERO -->
<section id="hero">
  <div class="container">
    <h1>Navettes directes vers les pistes ‚Äî Offre <u>compl√©mentaire aux TP</u></h1>
    <p class="muted" style="max-width:780px;margin:8px auto 0">
      Bus CarPostal <b>midi Iveco, 40 places</b>. Nous op√©rons uniquement l√† o√π la
      <b>voiture est nettement moins contraignante</b> que les TP (dur√©e, correspondances, marche) ‚Äî
      pour <b>compl√©ter</b> l‚Äôoffre publique, pas la concurrencer.
    </p>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <a class="btn primary" href="#reservation">Planifier un trajet</a>
      <a class="btn ghost" href="#avantages">Pourquoi c‚Äôest mieux ?</a>
    </div>
    <div class="hero-kpis">
      <div class="kpi"><strong>Vendredi‚ÄìDimanche</strong><br><span class="muted">saison de ski</span></div>
      <div class="kpi"><strong>3 bus</strong><br><span class="muted">Iveco midi ‚Ä¢ 40 places</span></div>
      <div class="kpi"><strong>D√©parts matin</strong><br><span class="muted">retours fin de journ√©e</span></div>
      <div class="kpi"><strong>Si√®ges premium</strong><br><span class="muted">+ tarification dynamique</span></div>
    </div>
    <div class="badge">Prototype MobilityLab 2025 üöÄ</div>
  </div>
</section>

<!-- OBJECTIFS -->
<section id="objectifs">
  <div class="container grid-2">
    <div class="card" style="padding:16px"><h3>üí° Innovation & revenus</h3><p class="muted">Tarifs dynamiques + upsell si√®ges premium + pack 5 A/R.</p></div>
    <div class="card" style="padding:16px"><h3>üôå R√©pond au march√©</h3><p class="muted">UX simple, infos utiles (m√©t√©o, carte), r√©servations en 3 √©tapes.</p></div>
    <div class="card" style="padding:16px"><h3>üåç R√©duction TIM</h3><p class="muted">Moins de voitures individuelles ‚Üí moins de CO‚ÇÇ et de congestion.</p></div>
    <div class="card" style="padding:16px"><h3>üß™ Prototype b√™ta</h3><p class="muted">Transparence & it√©rations rapides avec les retours.</p></div>
  </div>
</section>

<!-- COMMENT CA MARCHE -->
<section id="fonctionnement" style="background:var(--alt)">
  <div class="container">
    <h2>Comment √ßa marche</h2>
    <div class="grid-3">
      <div class="card adv">
        <img src="images/anzere.jpg" alt="Choisir votre trajet (ex. Anz√®re)">
        <h3>1) Choisir un axe √©ligible</h3>
        <p class="muted">Nous desservons uniquement les axes o√π la voiture est <b>nettement plus simple</b> que les TP.</p>
      </div>
      <div class="card adv">
        <img src="images/ovronnaz.jpg" alt="Navette directe (ex. Ovronnaz)">
        <h3>2) Navette directe</h3>
        <p class="muted">Align√©e sur l‚Äôouverture des pistes, retour en fin de journ√©e.</p>
      </div>
      <div class="card adv">
        <img src="images/leukerbad.jpg" alt="R√©server (ex. Leukerbad)">
        <h3>3) R√©server & choisir un si√®ge</h3>
        <p class="muted">Paiement en ligne, <b>si√®ge premium</b> en option.</p>
      </div>
    </div>
  </div>
</section>

<!-- AVANTAGES -->
<section id="avantages">
  <div class="container">
    <h2>Pourquoi c‚Äôest mieux&nbsp;?</h2>
    <div class="grid-3">
      <div class="card adv">
        <img src="images/crans_montana.jpg" alt="Crans-Montana">
        <h3>‚è± +40‚Äì80 min gagn√©es</h3>
        <p class="muted">vs trajets TP √† multiples correspondances.</p>
      </div>
      <div class="card adv">
        <img src="images/zinal.jpg" alt="Zinal">
        <h3>üß≥ Z√©ro correspondance</h3>
        <p class="muted">Centre-ville ‚Üí station, porte-skis √† bord.</p>
      </div>
      <div class="card adv">
        <img src="images/nax.jpg" alt="Nax">
        <h3>üå± Impact positif</h3>
        <p class="muted">Moins de voitures vers les vall√©es alpines.</p>
      </div>
    </div>
  </div>
</section>

<!-- RESERVATION (avec filtre √©ligibilit√©) -->
<section id="reservation" aria-label="R√©servation">
  <div class="container">
    <h2>Planifier & r√©server</h2>
    <div class="card">
      <div class="form-grid">
        <div>
          <label for="from">Ville de d√©part</label>
          <select id="from">
            <option value="">S√©lectionnez‚Ä¶</option>
            <option>Gen√®ve</option><option>Lausanne</option><option>Fribourg</option>
            <option>Berne</option><option>Sion</option>
          </select>
        </div>
        <div>
          <label for="to">Station (√©ligible uniquement)</label>
          <select id="to">
            <option value="">S√©lectionnez‚Ä¶</option>
            <!-- liste restreinte aux destinations o√π la voiture est nettement moins contraignante -->
            <option value="Anz√®re">Anz√®re</option>
            <option value="Crans-Montana">Crans-Montana</option>
            <option value="Leukerbad">Leukerbad</option>
            <option value="Nax/Mont-Noble">Nax / Mont-Noble</option>
            <option value="Ovronnaz">Ovronnaz</option>
            <option value="Zinal">Zinal</option>
          </select>
        </div>
        <div>
          <label for="date">Date (ven‚Äìdim)</label>
          <input type="date" id="date">
        </div>
        <div>
          <label for="pack">Pack 5 A/R</label>
          <select id="pack">
            <option value="no">Non</option>
            <option value="yes">Oui (CHF 100)</option>
          </select>
        </div>
        <div class="full inline">
          <button class="btn primary" id="searchBtn">Voir les navettes</button>
          <span class="pill">Flotte pilote : 3 bus ‚Äî Iveco midi 40 places</span>
          <span class="pill">Offre <b>compl√©mentaire aux TP</b></span>
        </div>
      </div>

      <div class="results" id="results">
        <div class="trip">
          <div>
            <strong id="summaryRoute">‚Äî</strong><br>
            <span class="muted" id="summaryTime">‚Äî</span><br>
            <span id="eligBadge" class="badge tp" title="Compl√©ment aux transports publics">Compl√©ment aux TP</span>
            <span id="eligWhy" class="muted" style="display:block;margin-top:4px">‚Äî</span>
          </div>
          <div>
            <span class="muted">Prix estim√©</span><br>
            <span class="price" id="price">‚Äî</span>
          </div>
          <div class="inline">
            <button class="btn" id="seatBtn" style="background:#eef5ff;color:#0d47a1">Choisir un si√®ge</button>
            <button class="btn primary" id="payBtn">Payer</button>
          </div>
        </div>

        <div id="seatArea" style="display:none">
          <h3 style="margin-top:12px">Plan du bus (Iveco midi 40 places)</h3>
          <p class="muted">Rang√©es 1‚Äì2 = <b>premium</b> (+CHF <span id="premiumFee">5</span>).</p>
          <div class="seat-map" id="seatMap"></div>
          <div class="legend">
            <div class="box"></div> <span class="muted">Standard</span>
            <div class="box prem"></div> <span class="muted">Premium</span>
            <span class="pill" id="seatChoice">Aucun si√®ge s√©lectionn√©</span>
          </div>
        </div>
      </div>

      <p class="muted" style="margin-top:10px">‚ùå Demi-tarif/abonnements TP non applicables (produit sp√©cifique CarPostal).</p>
    </div>
  </div>
</section>

<!-- TARIFS -->
<section id="tarifs" style="background:var(--alt)">
  <div class="container">
    <h2>Tarifs & offres</h2>
    <div class="grid-2">
      <div class="card" style="padding:18px;text-align:center">
        <img src="images/ovronnaz.jpg" alt="Pack 5 A/R" style="height:160px;object-fit:cover">
        <h3>üéüÔ∏è Pack 5 allers-retours</h3>
        <div class="price-big">CHF 100.‚Äì</div>
        <p class="muted">Soit CHF 20.‚Äì par A/R ¬∑ valable sur axes √©ligibles</p>
        <span class="badge" style="background:#fff8cc;border:1px solid #e6c200;color:#5f4b00">Meilleur rapport valeur</span>
      </div>
      <div class="card" style="padding:18px;text-align:center">
        <img src="images/zinal.jpg" alt="Tarif dynamique" style="height:160px;object-fit:cover">
        <h3>üí∫ Trajet √† l‚Äôunit√©</h3>
        <div class="price-big">d√®s CHF 25.‚Äì</div>
        <p class="muted">Tarification dynamique (type EasyJet) selon demande/date</p>
        <p class="muted">Option <b>si√®ge premium</b> au choix</p>
      </div>
    </div>
  </div>
</section>

<!-- CARTE -->
<section id="carte">
  <div class="container">
    <h2>Carte des itin√©raires (axes √©ligibles)</h2>
    <p class="muted">Nous op√©rons uniquement sur les axes o√π les TP sont moins performants (dur√©e, changements, marche). La carte se limite √† ces destinations.</p>
    <div id="map" role="img" aria-label="Carte des trajets (placeholder avec Nax)"></div>
  </div>
</section>

<!-- METEO -->
<section id="meteo" style="background:var(--alt)">
  <div class="container">
    <h2>M√©t√©o & neige</h2>
    <div class="weather">
      <div class="card wcard">
        <img src="images/crans_montana.jpg" alt="Crans-Montana">
        <h3>Crans-Montana</h3>
        <p class="muted">0 ¬∞C ¬∑ Ensoleill√© ¬∑ Neige: 120/200 cm</p>
      </div>
      <div class="card wcard">
        <img src="images/anzere.jpg" alt="Anz√®re">
        <h3>Anz√®re</h3>
        <p class="muted">-1 ¬∞C ¬∑ √âclaircies ¬∑ Neige: 90/170 cm</p>
      </div>
      <div class="card wcard">
        <img src="images/leukerbad.jpg" alt="Leukerbad">
        <h3>Leukerbad</h3>
        <p class="muted">-3 ¬∞C ¬∑ Chutes faibles ¬∑ Neige: 110/180 cm</p>
      </div>
    </div>
    <p class="muted" style="margin-top:8px;font-size:.9rem">*Connexion API m√©t√©o/neige possible (Open-Meteo / MeteoSwiss + flux stations).</p>
  </div>
</section>

<!-- FAQ -->
<section id="faq" style="background:var(--alt)">
  <div class="container">
    <h2>FAQ</h2>
    <details><summary>Pourquoi certaines stations ne sont pas propos√©es&nbsp;?</summary>
      <p>Parce que nous ne voulons pas concurrencer les TP. Nous op√©rons <b>uniquement</b> l√† o√π la voiture est beaucoup moins contraignante que les TP (trajets plus courts, moins de changements, marche r√©duite).</p>
    </details>
    <details><summary>Quel bus utilisez-vous&nbsp;?</summary>
      <p>Un <b>CarPostal midi Iveco ‚Äì 40 places</b>. 3 bus pendant la phase pilote.</p>
    </details>
    <details><summary>Le demi-tarif est-il valable&nbsp;?</summary>
      <p>Non, il s‚Äôagit d‚Äôun produit sp√©cifique CarPostal, distinct de l‚Äôoffre TP.</p>
    </details>
  </div>
</section>

<footer>
  <div class="container footgrid">
    <div>
      <strong>PostBus Connect</strong><br>
      <span class="muted">¬© 2025 MobilityLab & CarPostal</span><br>
      <span class="muted">Prototype ‚Äì offre compl√©mentaire aux TP</span>
    </div>
    <div>
      <strong>Navigation</strong><br>
      <a href="#reservation">R√©server</a><br>
      <a href="#tarifs">Tarifs</a><br>
      <a href="#faq">FAQ</a>
    </div>
    <div>
      <strong>L√©gal</strong><br>
      <a href="#">Mentions</a><br>
      <a href="#">Conditions</a><br>
      <a href="#">Confidentialit√©</a>
    </div>
  </div>
</footer>

<script>
/* ====== Data √©ligibilit√© : on ne propose que les axes ‚Äúcompl√©ment aux TP‚Äù ======
   Pour chaque station, on indique la raison (TP vs voiture). Ces raisons s‚Äôaffichent dans l‚ÄôUI. */
const ELIGIBILITY = {
  "Anz√®re": {eligible:true, reason:"TP : 2‚Äì3 changements ‚Ä¢ +45‚Äì60 min vs voiture"},
  "Crans-Montana": {eligible:true, reason:"TP : 2‚Äì3 changements ‚Ä¢ +40‚Äì55 min vs voiture"},
  "Leukerbad": {eligible:true, reason:"TP : 3 changements ‚Ä¢ +60 min vs voiture"},
  "Nax/Mont-Noble": {eligible:true, reason:"TP : 2‚Äì3 changements ‚Ä¢ +50 min vs voiture"},
  "Ovronnaz": {eligible:true, reason:"TP : 2‚Äì3 changements ‚Ä¢ +45 min vs voiture"},
  "Zinal": {eligible:true, reason:"TP : 3 changements ‚Ä¢ +70 min vs voiture"}
  // Toute station absente est consid√©r√©e non √©ligible ‚Üí on recommande les TP
};

/* ====== R√©servation & logique ‚Äúcompl√©ment aux TP‚Äù ====== */
const premiumFeeBase = 5;               // CHF
const seatRows = 8, seatCols = 5;       // 40 places (Iveco midi)
const premiumRows = 2;                  // rang 1-2 = premium
let selectedSeat = null;
let currentPrice = 0;

const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);

function isWeekend(dateStr){
  const d = new Date(dateStr+"T12:00:00"); if(isNaN(d)) return false;
  const wd = d.getDay(); return wd===5 || wd===6 || wd===0; // ven/sam/dim
}
function dynamicBasePrice(dateStr){
  const d = new Date(dateStr+"T12:00:00"); const now = new Date();
  const dd = Math.ceil((d-now)/86400000);
  let base = 25; if(dd<=3) base=38; else if(dd<=10) base=32; else base=27;
  const demand = 0.85 + Math.random()*0.6; // 0.85..1.45
  return Math.round(base*demand);
}
function randomSchedule(){
  const r=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const dep=`${String(r(6,7)).padStart(2,'0')}:${r(0,1)?'30':'00'}`;
  const ret=`${String(r(16,17)).padStart(2,'0')}:${r(0,1)?'15':'45'}`;
  return {dep,ret};
}
function CHF(n){ return "CHF "+n.toFixed(0)+".-"; }

function buildSeatMap(){
  const map = $("#seatMap"); map.innerHTML="";
  for(let r=1;r<=seatRows;r++){
    for(let c=1;c<=seatCols;c++){
      const idx=(r-1)*seatCols+c;
      const b=document.createElement("button");
      b.type="button"; b.className="seat"+(r<=premiumRows?" premium":"");
      b.textContent=idx; b.setAttribute("aria-label","Si√®ge "+idx+(r<=premiumRows?" premium":""));
      b.onclick=()=>{ $$(".seat").forEach(s=>s.classList.remove("selected")); b.classList.add("selected");
        selectedSeat={index:idx,premium:r<=premiumRows}; $("#seatChoice").textContent=`Si√®ge ${idx}`+(selectedSeat.premium?" (premium)":""); updatePrice(); };
      map.appendChild(b);
    }
  }
}
function updatePrice(){
  let p=currentPrice; if(selectedSeat?.premium) p+=premiumFeeBase; $("#price").textContent = CHF(p);
}

$("#searchBtn").addEventListener("click", ()=>{
  const from=$("#from").value.trim(), to=$("#to").value.trim(), date=$("#date").value, pack=$("#pack").value;
  if(!from||!to||!date){ alert("Merci de compl√©ter ville, station et date."); return; }
  if(!isWeekend(date)){ alert("Les navettes roulent ven/sam/dim pendant la saison de ski."); return; }

  // V√©rification d'√©ligibilit√© (compl√©ment aux TP)
  const meta = ELIGIBILITY[to] || {eligible:false, reason:"Axe bien desservi par les TP ‚Äî privil√©giez les transports publics."};
  $("#summaryRoute").textContent=`${from} ‚Üí ${to}`;
  const sc=randomSchedule(); $("#summaryTime").textContent=`D√©part ${sc.dep} ‚Äî Retour ${sc.ret}`;
  $("#eligWhy").textContent = meta.reason;

  if(!meta.eligible){
    $("#eligBadge").className="badge block";
    $("#eligBadge").textContent="Non √©ligible (privil√©gier les TP)";
    $("#price").textContent="‚Äî";
    $("#seatArea").style.display="none";
    $("#results").style.display="block";
    return; // on n'ouvre pas la vente
  } else {
    $("#eligBadge").className="badge tp";
    $("#eligBadge").textContent="Compl√©ment aux TP";
  }

  // Prix
  if(pack==="yes"){ currentPrice=20; $("#price").textContent="Inclus pack (CHF 20.- / A-R)"; }
  else { currentPrice=dynamicBasePrice(date); updatePrice(); }

  // Si√®ges
  selectedSeat=null; $("#seatChoice").textContent="Aucun si√®ge s√©lectionn√©";
  $("#seatArea").style.display="none";
  if($("#seatMap").children.length===0) buildSeatMap();

  $("#results").style.display="block";
});

$("#seatBtn").addEventListener("click", ()=>{
  if($("#eligBadge").classList.contains("block")){ alert("Cet axe n'est pas √©ligible : privil√©giez les TP."); return; }
  $("#seatArea").style.display = $("#seatArea").style.display==="none" ? "block" : "none";
});

$("#payBtn").addEventListener("click", ()=>{
  if($("#eligBadge").classList.contains("block")){ alert("Nous ne vendons pas cet axe (bien desservi par les TP)."); return; }
  const msg = selectedSeat ?
    `R√©servation : ${$("#summaryRoute").textContent}\n${$("#summaryTime").textContent}\n`+
    `Tarif : ${$("#price").textContent}\nSi√®ge : ${selectedSeat.index}${selectedSeat.premium?" (premium)":""}\n\n`+
    `√âtape paiement (prototype).` :
    `Astuce : choisissez un si√®ge (optionnel) puis payez.`;
  alert(msg);
});

/* Pr√©remplir une date de week-end proche */
(function(){
  const input=$("#date"); const t=new Date(); let d=new Date(t);
  for(let i=0;i<14;i++){ d=new Date(d.getTime()+86400000); if([5,6,0].includes(d.getDay())) break; }
  input.value=d.toISOString().split('T')[0];
})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PostBus Connect â€” MagicPass Express</title>
<link rel="icon" type="image/png" href="icons/favicon.png">
<link rel="icon" type="image/x-icon" href="icons/favicon.ico">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="assets/brand.css">
</head>
<body>
<header>
  <div class="head">
    <div class="logo">P</div>
    <div class="brand">PostBus Connect</div>
    <div style="margin-left:auto">Powered by <b>MobilityLab</b> â€” OpÃ©rÃ© par <b>CarPostal</b></div>
  </div>
</header>

<section class="hero">
  <div class="hero-in">
    <h1 class="title">MagicPass Express Â· Navettes directes vers les pistes</h1>
    <p class="subtitle">Quand les transports publics sont trop longs, nos navettes directes optimisent le trajet depuis les villes vers les stations. Horaires alignÃ©s, confort, porteâ€‘skis, confirmation instantanÃ©e.</p>
    <div class="cta-row">
      <a href="#plan" class="btn primary">Planifier un trajet</a>
      <a href="#why" class="btn">Pourquoi câ€™est mieux ?</a>
    </div>
  </div>
</section>

<div class="wrap" id="why">
  <div class="grid-3">
    <div class="panel">
      <h3>âœ¨ Avantages clÃ©s</h3>
      <ul>
        <li>â± <b>+40â€“80 min</b> gagnÃ©es vs. TP</li>
        <li>ğŸ§© <b>0 correspondance</b> â€” monte & dÃ©tendsâ€‘toi</li>
        <li>ğŸŸ <b>Prix MagicPass</b>, confort, porteâ€‘skis</li>
        <li>ğŸŒ± <b>-75% COâ‚‚</b> vs. voiture (navette remplie)</li>
      </ul>
    </div>
    <div class="panel">
      <h3>âš™ï¸ Comment Ã§a marche</h3>
      <ul>
        <li>1. Choisis <b>dÃ©part</b> & <b>destination</b></li>
        <li>2. Si TP trop lents âœ <b>navette directe</b></li>
        <li>3. RÃ©serve (simulation) en 2 clics</li>
      </ul>
    </div>
    <div class="panel">
      <h3>ğŸš— Pourquoi pas la voiture / TP ?</h3>
      <ul>
        <li>Voiture : bouchons, parkings chers, stress</li>
        <li>TP : 2â€“3 correspondances, marche, lenteur</li>
        <li>Navette : directe, horaire optimisÃ©, confort</li>
      </ul>
    </div>
  </div>
</div>

<div class="wrap" id="plan">
  <div class="panel">
    <h3>ğŸ§­ ItinÃ©raires disponibles (simulation)</h3>
    <p class="subtitle">Clique sur Â« Voir sur la carte Â» pour afficher le tracÃ©.</p>
  </div>
  <main id="cards"></main>
  <div id="map" role="img" aria-label="Carte des itinÃ©raires"></div>
  <footer>Â© 2025 PostBus Connect â€” <b>Powered by MobilityLab</b> â€” DonnÃ©es & exploitation : CarPostal â€” DÃ©mo.</footer>
</div>

<script>
const grid = document.getElementById('cards');
const map = L.map('map').setView([46.8182, 8.2275], 8);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap'}).addTo(map);
let layers=[]; function clearMap(){ layers.forEach(l=>map.removeLayer(l)); layers=[]; }

function bars(times){ const max=Math.max(times.car,times.pt,times.shuttle)||1,H=64,s=v=>Math.max(8,Math.round(v/max*H)); return {car:s(times.car),tp:s(times.pt),sh:s(times.shuttle)}; }

function card(r){
  const h=bars(r.times), gain=r.times.pt-r.times.shuttle, rec=gain>=30;
  const el=document.createElement('article'); el.className='card';
  el.innerHTML=`
    <div class="image"><img src="${r.image}" alt="${r.to}"></div>
    <div class="badge ${rec?'':'warn'}">${rec?('+'+gain+' min gagnÃ©es'):'Gain limitÃ©'}</div>
    <div class="content">
      <h3 class="route">${r.from} â†’ ${r.to}</h3>
      <div class="details">ğŸš— ${r.times.car} min Â· ğŸšŒ TP ${r.times.pt} min Â· ğŸŸ¢ Navette ${r.times.shuttle} min</div>
      <div class="mini">
        <div class="bar car" style="height:${h.car}px">V</div>
        <div class="bar tp"  style="height:${h.tp}px">TP</div>
        <div class="bar sh"  style="height:${h.sh}px">Nav</div>
      </div>
      <div class="cta">
        <a class="btn primary" href="#map" data-map>Voir sur la carte</a>
      </div>
    </div>`;
  el.querySelector('[data-map]').addEventListener('click',()=>{
    clearMap();
    const a=[r.from_coords.lat,r.from_coords.lon], b=[r.to_coords.lat,r.to_coords.lon];
    const m1=L.marker(a).addTo(map).bindPopup(r.from);
    const m2=L.marker(b).addTo(map).bindPopup(r.to);
    const line=L.polyline([a,b],{color:'#1DB954'}).addTo(map);
    layers.push(m1,m2,line);
    map.fitBounds(L.latLngBounds([a,b]).pad(0.2));
  });
  return el;
}

fetch('data/routes.json').then(r=>r.json()).then(list=>{
  list.forEach(r=> grid.appendChild(card(r)));
}).catch(e=>{ grid.innerHTML='<div class="panel">Erreur de chargement des donnÃ©es : '+e+'</div>'; });
</script>
</body>
</html>
